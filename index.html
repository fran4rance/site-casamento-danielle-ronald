<script>
  function setLang(lang) {
    document.querySelectorAll('.lang').forEach(el => {
      el.textContent = el.dataset[lang];
    });

    const uploader = document.querySelector('#upload');
    if (lang === 'es') {
      uploader.setAttribute('data-button-text', 'Enviar fotos de la fiesta ðŸ“¸');
      window.UPLOADCARE_LOCALE = 'es';
    } else {
      uploader.setAttribute('data-button-text', 'Enviar fotos da festa ðŸ“¸');
      window.UPLOADCARE_LOCALE = 'pt';
    }

    uploadcare.Widget(uploader).rebuild();
  }

  function launchConfetti() {
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    for (let i = 0; i < 100; i++) {
      ctx.beginPath();
      ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, 5, 0, Math.PI * 2);
      ctx.fillStyle = `hsl(${Math.random() * 30 + 10}, 70%, 60%)`;
      ctx.fill();
    }

    setTimeout(() => ctx.clearRect(0, 0, canvas.width, canvas.height), 3000);
  }

  document.addEventListener('DOMContentLoaded', () => {
    setLang('pt');

    uploadcare.Widget('#upload').onChange(fileGroup => {
      fileGroup.promise().then(() => {
        const msg = document.getElementById('mensagem-sucesso');
        msg.style.display = 'block';
        const currentLang = window.UPLOADCARE_LOCALE === 'es' ? 'es' : 'pt';
        msg.textContent = msg.dataset[currentLang];
        launchConfetti();
      });
    });
  });
</script>
